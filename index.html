<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi App Dinámica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <!-- Navegación -->
    <nav class="bg-white shadow p-4 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-indigo-600 flex items-center gap-2">
                <i class="ph-fill ph-storefront"></i> Mi Tienda/Blog
            </h1>
            <!-- Botón simulado de contacto -->
            <a href="#" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700">Contacto</a>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto mt-8 p-4">
        
        <!-- Mensaje de Bienvenida (Controlado desde Admin) -->
        <div id="welcome-section" class="bg-indigo-100 rounded-2xl p-8 mb-8 text-center animate-pulse">
            <h2 id="titulo-web" class="text-3xl font-bold text-indigo-900 mb-2">Cargando título...</h2>
            <p id="mensaje-web" class="text-indigo-700">Esperando actualización del admin...</p>
        </div>

        <!-- Lista de Contenido (Productos/Noticias) -->
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
            <i class="ph-duotone ph-newspaper"></i> Novedades
        </h3>
        
        <div id="items-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Aquí aparecerán los items mágicamente -->
            <div class="text-center text-gray-400 py-10 col-span-full">
                Cargando datos...
            </div>
        </div>

    </main>

    <!-- Configuración de Firebase y Lógica -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Configuración automática (No tocar)
        const firebaseConfig = JSON.parse(new URLSearchParams(window.location.search).get('firebase_config') || '{}');
        // NOTA: En GitHub Pages real, necesitarás poner tu propia config aquí.
        // Como estamos en un entorno de prueba, esto funcionará aquí, pero te explicaré
        // cómo hacerlo en GitHub al final.
        
        // Usamos la configuración del entorno si está disponible
        const app = initializeApp(typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'mi-app-demo';

        // 1. Autenticación Anónima (Necesaria para leer la base de datos)
        signInAnonymously(auth).then(() => {
            console.log("Conectado como usuario anónimo");
            iniciarEscucha();
        }).catch((error) => console.error("Error auth:", error));

        function iniciarEscucha() {
            // Escuchar el Título y Mensaje Principal
            const configRef = collection(db, 'artifacts', appId, 'public', 'data', 'configuracion');
            
            onSnapshot(configRef, (snapshot) => {
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.titulo) document.getElementById('titulo-web').innerText = data.titulo;
                    if (data.mensaje) document.getElementById('mensaje-web').innerText = data.mensaje;
                    // Quitar animación de carga
                    document.getElementById('welcome-section').classList.remove('animate-pulse');
                });
            });

            // Escuchar la lista de Items (Productos/Noticias)
            const itemsRef = collection(db, 'artifacts', appId, 'public', 'data', 'items');
            
            onSnapshot(itemsRef, (snapshot) => {
                const container = document.getElementById('items-container');
                container.innerHTML = ''; // Limpiar lista

                if (snapshot.empty) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500">No hay novedades publicadas aún.</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const item = doc.data();
                    const card = document.createElement('div');
                    card.className = "bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow";
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-lg text-gray-800">${item.titulo || 'Sin título'}</h4>
                            <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">Nuevo</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">${item.descripcion || ''}</p>
                        <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                            <span class="font-bold text-indigo-600">${item.precio ? '$' + item.precio : 'Gratis'}</span>
                            <button class="text-sm text-indigo-600 font-semibold hover:underline">Ver más</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }
    </script>
</body>
</html>
